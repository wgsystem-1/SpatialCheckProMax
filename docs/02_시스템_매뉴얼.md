# SpatialCheckProMax 시스템 매뉴얼

| 항목 | 내용 |
|------|------|
| 문서 버전 | 2.0 |
| 작성일 | 2025년 12월 |
| 최종 수정 | 2026-01-04 (AI 기능 추가) |
| 작성자 | (주)우리강산시스템 |

---

## 1. 시스템 요구사항

### 1.1 하드웨어 요구사항

| 구분 | 최소 사양 | 권장 사양 |
|------|----------|----------|
| **CPU** | Intel Core i5 (4코어) | Intel Core i7/i9 (8코어 이상) |
| **RAM** | 8GB | 16GB 이상 |
| **저장장치** | HDD 10GB 여유 공간 | SSD 20GB 이상 여유 공간 |
| **해상도** | 1920×1080 | 2560×1440 이상 |
| **GPU** | - | CUDA 지원 GPU (AI 가속용, 선택적) |

### 1.2 소프트웨어 요구사항

| 구분 | 요구사항 |
|------|----------|
| **운영체제** | Windows 10 (64-bit) 버전 1903 이상 또는 Windows 11 |
| **.NET 런타임** | .NET 9.0 Desktop Runtime (Self-contained 배포 시 불필요) |
| **Visual C++** | Visual C++ Redistributable 2019 이상 |

### 1.3 지원 데이터 형식

| 형식 | 확장자 | 읽기 | 쓰기 |
|------|--------|------|------|
| File Geodatabase | .gdb | ✅ | ✅ |
| Shapefile | .shp | ✅ | ✅ |
| GeoPackage | .gpkg | ✅ | ✅ |

---

## 2. 설치 가이드

### 2.1 설치 전 준비사항

1. **관리자 권한 확인**: 설치 시 관리자 권한이 필요할 수 있습니다.
2. **디스크 공간 확인**: 최소 1GB의 여유 공간이 필요합니다.
3. **기존 버전 제거**: 이전 버전이 설치되어 있다면 먼저 제거합니다.

### 2.2 설치 방법

#### 방법 1: 배포 패키지 설치 (권장)

1. 배포 폴더에서 `SpatialCheckProMax.GUI.exe`를 원하는 위치로 복사합니다.
2. 폴더 전체를 복사해야 합니다 (DLL 및 설정 파일 포함).

```
배포 폴더 구조:
SpatialCheckProMax/
├── SpatialCheckProMax.GUI.exe          # 실행 파일
├── SpatialCheckProMax.dll              # 핵심 라이브러리
├── appsettings.json                 # 애플리케이션 설정
├── Config/                          # 검수 설정 파일
│   ├── 1_table_check.csv
│   ├── 2_schema_check.csv
│   ├── 3_geometry_check.csv
│   ├── 4_attribute_check.csv
│   ├── 5_relation_check.csv
│   ├── geometry_criteria.csv
│   └── codelist.csv
├── Resources/                       # 리소스 파일 (v2.0)
│   └── Models/                      # AI 모델 파일
│       ├── geometry_corrector.onnx  # ONNX 모델
│       └── model_metadata.json      # 모델 메타정보
├── runtimes/                        # 네이티브 라이브러리
│   └── win-x64/
│       └── native/
└── [기타 DLL 파일들]
```

#### 방법 2: Framework-dependent 설치

.NET 9.0 런타임이 설치되어 있는 경우:

1. `.NET 9.0 Desktop Runtime`을 Microsoft 공식 사이트에서 다운로드하여 설치합니다.
   - URL: https://dotnet.microsoft.com/download/dotnet/9.0
2. 배포 폴더를 원하는 위치로 복사합니다.

### 2.3 설치 확인

1. `SpatialCheckProMax.GUI.exe`를 더블클릭하여 실행합니다.
2. 프로그램이 정상적으로 시작되면 설치가 완료된 것입니다.

**[이미지 삽입 위치: 프로그램 시작 화면]**

---

## 3. 초기 설정

### 3.1 애플리케이션 설정 (appsettings.json)

프로그램 실행 전 `appsettings.json` 파일을 필요에 따라 수정합니다.

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning"
    }
  },
  "ValidationSettings": {
    "DefaultOutputPath": "C:\\QC_Results",
    "EnableParallelProcessing": true,
    "MaxDegreeOfParallelism": 4
  },
  "AiSettings": {
    "ModelPath": "Resources/Models/geometry_corrector.onnx",
    "MaxVertices": 500,
    "EnableAiCorrection": true
  }
}
```

| 설정 항목 | 설명 | 기본값 |
|----------|------|--------|
| LogLevel | 로그 출력 수준 | Information |
| DefaultOutputPath | 기본 결과 저장 경로 | C:\QC_Results |
| EnableParallelProcessing | 병렬 처리 활성화 | true |
| MaxDegreeOfParallelism | 최대 병렬 처리 수 | 4 |
| **ModelPath** | AI 모델 파일 경로 (v2.0) | Resources/Models/geometry_corrector.onnx |
| **MaxVertices** | AI 처리 최대 정점 수 (v2.0) | 500 |
| **EnableAiCorrection** | AI 자동 수정 활성화 (v2.0) | true |

### 3.2 검수 설정 파일 구성

`Config/` 폴더의 CSV 파일들을 검수 요구사항에 맞게 수정합니다.

#### 3.2.1 테이블 검수 설정 (1_table_check.csv)

```csv
TableId,TableName,GeometryType,CRS
tn_buld,건물,POLYGON,EPSG:5179
tn_rodway_bndry,도로경계면,POLYGON,EPSG:5179
tn_rodway_ctln,도로중심선,LINESTRING,EPSG:5179
```

| 컬럼 | 설명 |
|------|------|
| TableId | 테이블 물리적 이름 |
| TableName | 테이블 한글명 |
| GeometryType | 기대 지오메트리 타입 (POLYGON, LINESTRING, POINT) |
| CRS | 좌표계 (예: EPSG:5179) |

#### 3.2.2 규칙 비활성화 방법

검수 규칙을 임시로 비활성화하려면:

**방법 1**: 규칙 ID 앞에 `#` 추가 (주석 처리)
```csv
#tn_mapindx_5k,도곽(1:5000),POLYGON,EPSG:5179
```

**방법 2**: `Enabled` 컬럼을 `N`으로 설정 (4, 5단계)
```csv
LOG_DOM_ATR_001,N,tn_buld,건물,bldg_se,NotNull,,건물구분 필수
```

---

## 4. 시스템 구성

### 4.1 메인 화면 구성

**[이미지 삽입 위치: 메인 화면 전체 스크린샷]**

프로그램 실행 시 다음과 같은 메인 화면이 표시됩니다:

| 영역 | 설명 |
|------|------|
| ① 상단 메뉴 | 파일 열기, 설정, 도움말 |
| ② 좌측 패널 | 검수 파일 목록 |
| ③ 중앙 영역 | 대시보드 / 검수 결과 표시 |
| ④ 하단 상태바 | 진행 상황 및 상태 표시 |

### 4.2 화면 구성 상세

#### 4.2.1 대시보드 (WideDashboardView)

**[이미지 삽입 위치: 대시보드 화면]**

| 항목 | 설명 |
|------|------|
| 총 피처 수 | 검수 대상 전체 피처 수 |
| 테이블 수 | 검수 대상 테이블 수 |
| 검출 오류 | 단계별 검출된 오류 수 |
| 진행률 | 검수 진행 상태 표시 |

#### 4.2.2 검수 결과 (ValidationResultView)

**[이미지 삽입 위치: 검수 결과 화면]**

탭별로 검수 결과를 확인할 수 있습니다:

| 탭 | 내용 |
|-----|------|
| 테이블 검수 | 테이블 존재 여부, 좌표계, 지오메트리 타입 |
| 스키마 검수 | 컬럼 구조, 데이터 타입, 제약조건 |
| 지오메트리 검수 | 중복, 겹침, 꼬임, 슬리버 등 (**AI 자동 수정 지원** v2.0) |
| 속성 검수 | 속성값 유효성, 코드리스트 |
| 관계 검수 | 공간 관계 오류 |

---

## 5. 검수 프로세스

### 5.1 6단계 검수 체계

```
┌──────────────────────────────────────────────────────────┐
│  0단계: FileGDB 완전성 검사                                │
│  - 디렉터리/확장자 확인                                    │
│  - 코어 시스템 테이블 확인                                 │
│  - .gdbtable/.gdbtablx 페어 확인                          │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│  1단계: 테이블 검사 (1_table_check.csv)                    │
│  - 테이블 존재 여부 확인                                   │
│  - 좌표계(CRS) 검증                                       │
│  - 지오메트리 타입 검증                                    │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│  2단계: 스키마 검사 (2_schema_check.csv)                   │
│  - 컬럼 존재 여부 확인                                     │
│  - 데이터 타입 검증                                       │
│  - 길이/제약조건 검증                                      │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│  3단계: 지오메트리 검사 (3_geometry_check.csv)             │
│  - 객체 중복 검사                                         │
│  - 객체 간 겹침 검사                                       │
│  - 자체 꼬임(Self-Intersection) 검사                      │
│  - 슬리버 폴리곤 검사                                      │
│  - 짧은 객체/작은 면적 검사                                │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│  4단계: 속성 검사 (4_attribute_check.csv)                  │
│  - NotNull, NotZero 검사                                  │
│  - 범위(Range) 검사                                       │
│  - 코드리스트 검사                                        │
│  - 조건부 검사 (IfCodeThen...)                            │
│  - 정규식 패턴 검사                                       │
└──────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────┐
│  5단계: 관계 검사 (5_relation_check.csv)                   │
│  - 폴리곤 간 겹침 금지 검사                                │
│  - 선형 포함 관계 검사                                     │
│  - 점 포함 관계 검사                                       │
│  - 연결성 검사                                            │
│  - 속성 연속성 검사                                       │
└──────────────────────────────────────────────────────────┘
```

### 5.2 검수 결과 저장 구조

검수 완료 후 결과는 다음과 같이 저장됩니다:

```
검수_결과_폴더/
├── QC_검수파일명.gdb/           # QC 오류 FileGDB
│   ├── QC_Errors_Point          # 점형 오류
│   ├── QC_Errors_Line           # 선형 오류
│   └── QC_Errors_Polygon        # 면형 오류
├── 검수보고서.pdf               # PDF 보고서
├── 검수결과.html                # HTML 보고서
└── 검수로그.log                 # 상세 로그 파일
```

---

## 6. QC_ERRORS 테이블 구조

### 6.1 필드 정의

검수 오류는 FileGDB의 QC_ERRORS 테이블에 저장됩니다.

| 필드명 | 데이터 타입 | 설명 |
|--------|------------|------|
| GlobalID | String | 고유 식별자 (GUID) |
| ErrType | String | 오류 유형 (GEOM, REL, ATTR, SCHEMA) |
| ErrCode | String | 오류 코드 (예: RDC001, OVL002) |
| RuleId | String | 규칙 ID |
| TableId | String | 오류 발생 테이블 ID |
| TableName | String | 오류 발생 테이블 한글명 |
| SourceOID | Integer | 오류 객체의 OBJECTID |
| RelatedTableId | String | 관련 테이블 ID (관계 검수용) |
| RelatedTableName | String | 관련 테이블 한글명 |
| Message | String | 오류 메시지 |
| DetailsJSON | String | 상세 정보 (JSON 형식) |
| RunID | String | 검수 실행 ID |

### 6.2 DetailsJSON 예시

#### 지오메트리 검수 오류
```json
{
  "CheckType": "지오메트리 검수",
  "TableId": "tn_buld",
  "ErrorType": "OVERLAP",
  "OverlapArea": 15.23,
  "Tolerance": 0.1
}
```

#### 관계 검수 오류
```json
{
  "CheckType": "관계 검수",
  "RelationType": "PolygonNotOverlap",
  "RelatedTableId": "tn_rodway_bndry",
  "RelatedTableName": "도로경계면"
}
```

#### 스키마 검수 오류
```json
{
  "CheckType": "스키마 검수",
  "ColumnName": "bldg_se",
  "ColumnKoreanName": "건물구분",
  "ExpectedDataType": "String",
  "ActualDataType": "Integer"
}
```

---

## 7. 보고서 출력

### 7.1 PDF 보고서

**[이미지 삽입 위치: PDF 보고서 샘플]**

PDF 보고서에는 다음 내용이 포함됩니다:

| 섹션 | 내용 |
|------|------|
| 표지 | 보고서 제목, 작성일, 대상 파일 |
| 검수 개요 | 전체 통계 요약 |
| 단계별 결과 | 각 단계별 검수 결과 상세 |
| 오류 목록 | 상위 오류 목록 및 통계 |

### 7.2 HTML 보고서

**[이미지 삽입 위치: HTML 보고서 샘플]**

웹 브라우저에서 열 수 있는 인터랙티브 보고서입니다.

---

## 8. 문제 해결

### 8.1 일반적인 오류

#### 오류: "GDAL 초기화 실패"

**원인**: GDAL 네이티브 라이브러리 로드 실패

**해결 방법**:
1. `runtimes/win-x64/native/` 폴더가 존재하는지 확인
2. Visual C++ Redistributable 2019 이상 설치 여부 확인
3. 관리자 권한으로 실행

#### 오류: "PROJ 데이터베이스 버전 불일치"

**원인**: 시스템에 설치된 다른 GIS 소프트웨어(PostgreSQL/PostGIS)와 충돌

**해결 방법**:
1. 환경 변수에서 PostgreSQL 관련 PATH 제거
2. 또는 프로그램 실행 전 다른 GIS 소프트웨어 종료

#### 오류: "파일을 열 수 없습니다"

**원인**: 파일이 다른 프로그램에서 사용 중

**해결 방법**:
1. ArcGIS, QGIS 등에서 해당 GDB를 닫음
2. Windows 탐색기에서 미리보기 끄기
3. 파일 경로에 특수문자가 없는지 확인

### 8.2 성능 관련 문제

#### 검수 속도가 느린 경우

1. **병렬 처리 활성화**: `appsettings.json`에서 `EnableParallelProcessing: true`
2. **SSD 사용**: GDB 파일을 SSD에 저장
3. **메모리 확보**: 다른 프로그램 종료하여 메모리 확보
4. **대용량 파일**: 필요한 검수 규칙만 활성화

#### 메모리 부족 오류

1. 한 번에 하나의 GDB만 검수
2. 불필요한 검수 규칙 비활성화
3. 시스템 메모리 증설 고려

### 8.3 로그 파일 확인

문제 발생 시 로그 파일을 확인합니다:

```
로그 파일 위치: [실행파일경로]/logs/SpatialCheckProMax_YYYYMMDD.log
```

로그 레벨:
- `Information`: 일반 정보
- `Warning`: 경고 (계속 진행 가능)
- `Error`: 오류 (작업 실패)

---

## 9. 유지보수

### 9.1 정기 점검 항목

| 주기 | 점검 항목 |
|------|----------|
| 매일 | 로그 파일 확인 |
| 주간 | 디스크 공간 확인 |
| 월간 | 설정 파일 백업 |
| 분기 | 소프트웨어 업데이트 확인 |

### 9.2 백업 권장 항목

```
백업 대상:
├── Config/                    # 검수 설정 파일
│   ├── 1_table_check.csv
│   ├── 2_schema_check.csv
│   ├── 3_geometry_check.csv
│   ├── 4_attribute_check.csv
│   ├── 5_relation_check.csv
│   └── codelist.csv
├── appsettings.json           # 애플리케이션 설정
└── logs/                      # 로그 파일 (선택적)
```

### 9.3 업데이트 방법

1. 기존 설정 파일(`Config/`, `appsettings.json`) 백업
2. 새 버전의 파일을 기존 폴더에 덮어쓰기
3. 백업한 설정 파일 복원 (필요시)
4. 프로그램 실행하여 정상 동작 확인

---

## 10. 기술 지원

### 10.1 지원 문의

| 구분 | 연락처 |
|------|--------|
| 개발사 | (주)우리강산시스템 |
| 이메일 | support@wgsystem.co.kr |
| 전화 | 02-XXX-XXXX |

### 10.2 문의 시 포함 정보

문제 보고 시 다음 정보를 포함해 주세요:

1. **프로그램 버전**: 도움말 > 정보에서 확인
2. **운영체제**: Windows 버전 및 빌드 번호
3. **오류 메시지**: 정확한 오류 메시지 내용
4. **로그 파일**: `logs/` 폴더의 로그 파일 첨부
5. **재현 방법**: 오류 발생 단계별 설명

---

## 11. AI 자동 수정 기능 (v2.0)

### 11.1 개요

v2.0에서 추가된 AI 기반 지오메트리 오류 자동 수정 기능입니다. 검수 결과 화면에서 지오메트리 오류를 선택하고 "AI 자동 수정" 버튼을 클릭하면 AI 모델이 오류를 분석하여 자동으로 수정합니다.

### 11.2 지원 오류 유형

| 오류 유형 | AI 수정 지원 | 설명 |
|----------|------------|------|
| Self-Intersection (자체 꼬임) | ✅ | 폴리곤/라인의 자체 교차 수정 |
| Overlap (겹침) | ✅ | 객체 간 겹침 영역 조정 |
| Gap (틈) | ✅ | 인접 객체 간 틈 메우기 |
| Sliver (슬리버) | ✅ | 좁고 긴 불필요한 영역 제거 |
| Invalid Geometry | ✅ | 유효하지 않은 지오메트리 복구 |

### 11.3 사용 방법

1. 검수를 완료합니다.
2. **지오메트리 검수** 탭으로 이동합니다.
3. 수정할 오류 항목을 선택합니다.
4. **AI 자동 수정** 버튼을 클릭합니다.
5. 수정 결과를 확인하고 **GDB에 저장** 버튼으로 저장합니다.

### 11.4 AI 수정 파이프라인

```
원본 GDB에서 지오메트리 읽기
        ↓
AI 모델 추론 (GeometryGNN)
        ↓
타입 검증 (Polygon→Polygon 유지)
        ↓
유효성 검증 (IsValid 체크)
        ↓
타입 변경 시 Buffer(0) 폴백
        ↓
수정된 지오메트리 GDB에 저장
```

### 11.5 문제 해결

#### AI 모델 로드 실패

**원인**: ONNX 모델 파일 누락 또는 손상

**해결 방법**:
1. `Resources/Models/geometry_corrector.onnx` 파일 존재 확인
2. 파일이 손상된 경우 원본 배포 파일에서 복사

#### AI 수정 후 지오메트리 타입 변경

**원인**: AI 모델이 좌표를 극단적으로 수정하여 지오메트리가 축소됨

**해결 방법**:
- 시스템이 자동으로 Buffer(0) 폴백을 적용합니다.
- 로그에서 "타입 변경됨" 메시지 확인 가능

#### 정점 수 초과 경고

**원인**: 지오메트리의 정점 수가 최대 허용값(기본 500)을 초과

**해결 방법**:
1. `appsettings.json`의 `MaxVertices` 값 증가
2. 또는 수동으로 지오메트리 단순화 후 재시도

---

**문서 끝**


