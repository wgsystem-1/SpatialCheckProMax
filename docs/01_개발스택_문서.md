# SpatialCheckProMax 개발 스택 문서

| 항목 | 내용 |
|------|------|
| 문서 버전 | 2.0 |
| 작성일 | 2025년 12월 |
| 최종 수정 | 2026-01-04 (AI 기능 추가) |
| 작성자 | (주)우리강산시스템 |

---

## 1. 시스템 개요

### 1.1 프로그램 정보

| 항목 | 내용 |
|------|------|
| **프로그램명** | SpatialCheckProMax (국가기본도 DB 검수 시스템) |
| **버전** | 2.0.0 |
| **개발사** | (주)우리강산시스템 |
| **용도** | File Geodatabase(FGDB) 공간 데이터 품질 검수 및 AI 자동 수정 |

### 1.2 시스템 목적

- 국가기본도 DB의 공간 데이터 품질 보증
- 6단계 체계적 검수 프로세스 자동화
- 데이터 무결성 및 토폴로지 검증
- 검수 결과의 체계적 관리 및 보고서 생성
- **AI 기반 지오메트리 오류 자동 수정** (v2.0 신규)

---

## 2. 개발 환경

### 2.1 개발 플랫폼

| 구분 | 상세 내용 |
|------|----------|
| **운영체제** | Windows 10/11 (64-bit) |
| **개발 IDE** | Visual Studio 2022, Cursor |
| **형상관리** | Git |
| **빌드 시스템** | MSBuild (dotnet CLI) |

### 2.2 런타임 환경

| 구분 | 버전 | 설명 |
|------|------|------|
| **.NET** | 9.0 | 최신 .NET 런타임 |
| **C#** | 12.0 | 프로그래밍 언어 |
| **Windows** | 7.0+ | 지원 OS 버전 |

---

## 3. 기술 스택

### 3.1 프레임워크

| 프레임워크 | 버전 | 용도 |
|-----------|------|------|
| **.NET 9.0** | 9.0.0 | 핵심 런타임 환경 |
| **WPF** | - | Windows 데스크톱 UI 프레임워크 |
| **ASP.NET Core** | 9.0.0 | REST API 서버 (선택적) |
| **Entity Framework Core** | 9.0.10 | ORM 및 데이터베이스 접근 |

### 3.2 핵심 라이브러리

#### 공간 데이터 처리

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **MaxRev.Gdal.Core** | 3.10.0.306 | GDAL 바인딩 (FGDB 읽기/쓰기) | MIT |
| **MaxRev.Gdal.WindowsRuntime.Minimal** | 3.10.0.306 | Windows용 GDAL 네이티브 라이브러리 | MIT |
| **NetTopologySuite** | 2.6.0 | 지오메트리 연산 및 토폴로지 분석 | BSD-3-Clause |
| **NetTopologySuite.IO.GeoJSON** | 4.0.0 | GeoJSON 입출력 | BSD-3-Clause |

#### 데이터 처리

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **CsvHelper** | 33.1.0 | CSV 설정 파일 처리 | MS-PL / Apache-2.0 |
| **Microsoft.EntityFrameworkCore.Sqlite** | 9.0.10 | SQLite 데이터베이스 | MIT |
| **Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite** | 9.0.10 | 공간 데이터 지원 | MIT |

#### UI 및 MVVM

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **CommunityToolkit.Mvvm** | 8.4.0 | MVVM 패턴 구현 | MIT |
| **Microsoft.Xaml.Behaviors.Wpf** | 1.1.135 | XAML 동작 확장 | MIT |

#### 보고서 생성

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **iTextSharp.LGPLv2.Core** | 3.7.12 | PDF 보고서 생성 | LGPL-2.1 |
| **PDFsharp-MigraDoc-WPF** | 6.2.3 | PDF 문서 처리 | MIT |

#### 로깅 및 DI

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **Serilog** | 4.3.0 | 구조화된 로깅 | Apache-2.0 |
| **Serilog.Extensions.Logging** | 9.0.0 | Microsoft.Extensions.Logging 통합 | Apache-2.0 |
| **Microsoft.Extensions.DependencyInjection** | 9.0.10 | 의존성 주입 | MIT |
| **Microsoft.Extensions.Hosting** | 9.0.10 | 호스팅 추상화 | MIT |
| **Microsoft.Extensions.Logging** | 9.0.10 | 로깅 추상화 | MIT |

#### 통신

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **Grpc.Net.Client** | 2.71.0 | gRPC 클라이언트 | Apache-2.0 |
| **Google.Protobuf** | 3.33.1 | Protocol Buffers | BSD-3-Clause |
| **Microsoft.Extensions.Http** | 9.0.4 | HTTP 클라이언트 팩토리 | MIT |

#### AI/ML (v2.0 신규)

| 라이브러리 | 버전 | 용도 | 라이선스 |
|-----------|------|------|----------|
| **Microsoft.ML.OnnxRuntime** | 1.21.1 | ONNX 모델 추론 엔진 | MIT |
| **Microsoft.ML.OnnxRuntime.Managed** | 1.21.1 | ONNX 관리 래퍼 | MIT |

---

## 4. 프로젝트 구조

### 4.1 솔루션 구성

```
SpatialCheckProMax.sln
├── SpatialCheckProMax/              # 핵심 비즈니스 로직 라이브러리
├── SpatialCheckProMax.GUI/          # WPF GUI 애플리케이션
├── SpatialCheckProMax.Api/          # REST API 서버 (선택적)
└── SpatialCheckProMax.Tests/        # 단위 테스트
```

### 4.2 핵심 라이브러리 (SpatialCheckProMax)

```
SpatialCheckProMax/
├── Config/                   # CSV 검수 설정 파일
│   ├── 1_table_check.csv
│   ├── 2_schema_check.csv
│   ├── 3_geometry_check.csv
│   ├── 4_attribute_check.csv
│   ├── 5_relation_check.csv
│   ├── geometry_criteria.csv
│   └── codelist.csv
├── Constants/                # 상수 정의
├── Data/                     # Entity Framework 컨텍스트
├── Exceptions/               # 커스텀 예외 클래스
├── Extensions/               # 확장 메서드
├── Models/                   # 도메인 모델
│   ├── Config/              # 설정 모델
│   ├── Entities/            # DB 엔티티
│   └── Enums/               # 열거형
├── Processors/               # 검수 프로세서
│   ├── TableCheckProcessor.cs
│   ├── SchemaCheckProcessor.cs
│   ├── GeometryCheckProcessor.cs
│   ├── AttributeCheckProcessor.cs
│   └── RelationCheckProcessor.cs
├── Resources/                # 리소스 파일 (v2.0 신규)
│   └── Models/              # AI 모델 파일
│       └── geometry_corrector.onnx
├── Services/                 # 비즈니스 서비스
│   ├── Ai/                  # AI 서비스 (v2.0 신규)
│   │   └── GeometryAiCorrector.cs
│   └── IO/                  # 입출력 서비스
│       └── GdalGeometryWriter.cs
```

### 4.3 GUI 애플리케이션 (SpatialCheckProMax.GUI)

```
SpatialCheckProMax.GUI/
├── Views/                    # XAML UI 화면
├── ViewModels/               # MVVM 뷰모델
├── Services/                 # UI 서비스
├── Converters/               # 값 변환기
├── Styles/                   # UI 스타일
├── Assets/                   # 아이콘, 이미지
└── appsettings.json          # 애플리케이션 설정
```

---

## 5. 아키텍처 설계

### 5.1 계층 구조

```
┌─────────────────────────────────────────────────────┐
│                   Presentation Layer                 │
│              (SpatialCheckProMax.GUI - WPF)            │
├─────────────────────────────────────────────────────┤
│                  Application Layer                   │
│         (Services, ViewModels, Controllers)         │
├─────────────────────────────────────────────────────┤
│                   Business Logic Layer               │
│      (SpatialCheckProMax - Processors, Services)       │
├─────────────────────────────────────────────────────┤
│                    Data Access Layer                 │
│         (Entity Framework, GDAL, CSV Reader)        │
├─────────────────────────────────────────────────────┤
│                    Infrastructure                    │
│         (SQLite DB, File System, Logging)           │
└─────────────────────────────────────────────────────┘
```

### 5.2 설계 패턴

| 패턴 | 적용 위치 | 설명 |
|------|----------|------|
| **MVVM** | GUI 레이어 | Model-View-ViewModel 분리 |
| **Layered Architecture** | 전체 시스템 | 계층 분리 아키텍처 |
| **Dependency Injection** | 전체 시스템 | Microsoft.Extensions.DI 활용 |
| **Strategy Pattern** | Processors | 검수 프로세서 구현 |
| **Repository Pattern** | Data Access | 데이터 접근 추상화 |

### 5.3 설계 원칙

- **SOLID 원칙** 준수
- **관심사의 분리** (Separation of Concerns)
- **DRY** (Don't Repeat Yourself)
- **인터페이스 기반 설계** (의존성 역전)

---

## 6. 핵심 컴포넌트

### 6.1 검수 프로세서

| 프로세서 | 인터페이스 | 기능 |
|---------|-----------|------|
| TableCheckProcessor | ITableCheckProcessor | 테이블 존재/좌표계/지오메트리 타입 검사 |
| SchemaCheckProcessor | ISchemaCheckProcessor | 컬럼 구조/데이터 타입/제약조건 검사 |
| GeometryCheckProcessor | IGeometryCheckProcessor | 공간 오류(중복/겹침/꼬임 등) 검사 |
| AttributeCheckProcessor | IAttributeCheckProcessor | 속성값 유효성 검사 |
| RelationCheckProcessor | IRelationCheckProcessor | 공간 관계(포함/교차/이격) 검사 |

### 6.2 주요 서비스

| 서비스 | 기능 |
|--------|------|
| SimpleValidationService | 전체 검수 프로세스 오케스트레이션 |
| QcErrorService | QC 오류 저장/조회 |
| QcErrorDataService | FileGDB QC_ERRORS 테이블 관리 |
| ValidationResultConverter | 검수 결과 → QcError 변환 |
| ReportService | PDF/HTML 보고서 생성 |
| CsvConfigService | CSV 설정 파일 로드 |
| GdalInitializationService | GDAL 라이브러리 초기화 |
| **GeometryAiCorrector** | AI 기반 지오메트리 오류 자동 수정 (v2.0 신규) |
| **GeometryEditToolService** | 지오메트리 편집 및 AI 수정 통합 (v2.0 신규) |
| **GdalGeometryWriter** | FGDB 지오메트리 읽기/쓰기 (v2.0 신규) |

---

## 7. 데이터 관리

### 7.1 설정 파일 (CSV)

| 파일 | 단계 | 용도 |
|------|------|------|
| 1_table_check.csv | 1단계 | 테이블 검수 설정 |
| 2_schema_check.csv | 2단계 | 스키마 검수 설정 |
| 3_geometry_check.csv | 3단계 | 지오메트리 검수 설정 |
| 4_attribute_check.csv | 4단계 | 속성 검수 설정 |
| 5_relation_check.csv | 5단계 | 관계 검수 설정 |
| geometry_criteria.csv | 3단계+ | 지오메트리 임계값 |
| codelist.csv | 4단계+ | 코드리스트 정의 |

### 7.2 데이터베이스

| 구분 | 기술 | 용도 |
|------|------|------|
| **내부 DB** | SQLite | 검수 결과/이력 저장 |
| **QC FGDB** | File Geodatabase | 검수 오류 저장 (QC_ERRORS 테이블) |

---

## 8. 빌드 및 배포

### 8.1 빌드 명령어

```bash
# 디버그 빌드
dotnet build SpatialCheckProMax.GUI --configuration Debug

# 릴리스 빌드
dotnet build SpatialCheckProMax.GUI --configuration Release

# 배포용 빌드 (Self-contained)
dotnet publish SpatialCheckProMax.GUI -c Release -r win-x64 --self-contained true
```

### 8.2 출력 경로

| 구성 | 경로 |
|------|------|
| Debug | `SpatialCheckProMax.GUI/bin/Debug/net9.0-windows/` |
| Release | `SpatialCheckProMax.GUI/bin/Release/net9.0-windows/` |
| Publish | `SpatialCheckProMax.GUI/bin/Release/net9.0-windows/publish/` |

### 8.3 필수 구성 요소

- .NET 9.0 Runtime (Framework-dependent 배포 시)
- Visual C++ Redistributable 2019 이상
- Windows 10/11 (64-bit)

---

## 9. 성능 최적화 기술

### 9.1 병렬 처리

| 기술 | 설명 |
|------|------|
| **단계 병렬 처리** | 독립적인 검수 단계 동시 실행 |
| **데이터 병렬 처리** | 테이블/피처 청크 병렬 처리 |
| **동적 자원 할당** | CPU/메모리 가용량 기반 스레드 수 조절 |

### 9.2 메모리 최적화

| 기술 | 설명 |
|------|------|
| **DataSource 풀링** | GDAL DataSource 재사용 |
| **LRU 캐시** | 자주 사용하는 데이터 캐싱 |
| **공간 인덱싱** | R-Tree, Quad-Tree 인덱스 |

### 9.3 비동기 처리

- 모든 검수/파일 처리 작업 async/await 적용
- UI 스레드 차단 방지

---

## 10. 보안

### 10.1 적용 보안 기술

| 구분 | 설명 |
|------|------|
| **파일 경로 검증** | Path Traversal 공격 방지 |
| **허용 확장자 검사** | 승인된 파일 형식만 처리 |
| **활동 로깅** | 보안 관련 활동 모니터링 |

---

## 11. 라이선스 정보

### 11.1 본 소프트웨어

- **라이선스**: 별도 협의
- **저작권**: Copyright © 2025 (주)우리강산시스템

### 11.2 오픈소스 라이선스

본 소프트웨어는 다음의 오픈소스 라이브러리를 사용합니다:

| 라이브러리 | 라이선스 |
|-----------|----------|
| GDAL | MIT |
| NetTopologySuite | BSD-3-Clause |
| CsvHelper | MS-PL / Apache-2.0 |
| iTextSharp.LGPLv2.Core | LGPL-2.1 |
| Serilog | Apache-2.0 |
| Entity Framework Core | MIT |
| CommunityToolkit.Mvvm | MIT |
| Microsoft.ML.OnnxRuntime | MIT |

상세 라이선스 내용은 `LEGAL/` 폴더를 참조하십시오.

---

## 12. AI 기능 (v2.0 신규)

### 12.1 AI 지오메트리 자동 수정

v2.0에서 추가된 AI 기반 지오메트리 오류 자동 수정 기능입니다.

| 구분 | 내용 |
|------|------|
| **모델 아키텍처** | GeometryGNN (Graph Neural Network) |
| **모델 형식** | ONNX (Open Neural Network Exchange) |
| **추론 엔진** | Microsoft.ML.OnnxRuntime |
| **학습 프레임워크** | PyTorch (Python) |

### 12.2 AI 파이프라인

```
┌─────────────────────────────────────────────────────────────┐
│                    AI 자동 수정 파이프라인                     │
├─────────────────────────────────────────────────────────────┤
│  1. FGDB에서 원본 지오메트리 읽기 (GdalGeometryWriter)         │
│                         ↓                                    │
│  2. AI 모델 추론 (GeometryAiCorrector)                       │
│     - 좌표 정규화 및 패딩                                     │
│     - ONNX 모델 실행                                         │
│     - 보정 오프셋 적용                                        │
│                         ↓                                    │
│  3. 지오메트리 타입 검증                                      │
│     - 원본 타입과 수정 타입 비교                               │
│     - 타입 변경 시 Buffer(0) 폴백                             │
│                         ↓                                    │
│  4. 유효성 검증 및 GDB 저장 (GdalGeometryWriter)              │
└─────────────────────────────────────────────────────────────┘
```

### 12.3 지원 지오메트리 타입

| 타입 | AI 수정 지원 | 비고 |
|------|------------|------|
| Polygon | ✅ | 링 구조 자동 폐합 처리 |
| MultiPolygon | ✅ | 단일 지오메트리인 경우 |
| LineString | ✅ | - |
| MultiLineString | ✅ | 단일 지오메트리인 경우 |
| Point | ✅ | - |
| LinearRing | ✅ | 폐합 처리 |

### 12.4 모델 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| geometry_corrector.onnx | Resources/Models/ | 학습된 ONNX 모델 |
| model_metadata.json | Resources/Models/ | 모델 버전 및 메타정보 |

---

**문서 끝**


