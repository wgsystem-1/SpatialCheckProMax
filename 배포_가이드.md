# SpatialCheckProMax 배포 가이드

## 📦 배포 버전 구성 방안

### 1. 인스톨 버전 제작 가능 여부

**✅ 가능합니다.** 다음 도구를 사용하여 설치 프로그램을 만들 수 있습니다:

#### 추천 도구

1. **WiX Toolset** (Windows Installer XML)
   - Microsoft 공식 도구
   - MSI 설치 패키지 생성
   - Windows 표준 설치 경험 제공
   - 무료, 오픈소스

2. **Inno Setup**
   - 간단한 설정 파일 기반
   - 단일 실행 파일 생성 가능
   - 무료, 오픈소스

3. **NSIS (Nullsoft Scriptable Install System)**
   - 스크립트 기반
   - 작은 설치 파일 크기
   - 무료, 오픈소스

4. **Advanced Installer** (상용)
   - GUI 기반 설정
   - 상용 라이선스 필요

#### 설치 프로그램에 포함할 항목

- 실행 파일 (`SpatialCheckProMax.GUI.exe`)
- 의존 DLL 파일들
- GDAL Native DLL 파일들
- Config 디렉토리 (CSV 설정 파일들)
- .NET 8.0 런타임 (선택사항 - 아래 참조)

---

### 2. 오픈소스 라이브러리만 포함 가능 여부

**⚠️ 부분적으로 가능합니다.** 대부분의 라이브러리는 오픈소스이지만, 일부 상용 라이선스가 필요할 수 있습니다.

#### 오픈소스 라이브러리 (문제 없음)

| 라이브러리 | 라이선스 | 포함 가능 |
|-----------|---------|----------|
| **GDAL** | MIT/X11 | ✅ |
| **GDAL.Native** | MIT/X11 | ✅ |
| **NetTopologySuite** | BSD-3-Clause | ✅ |
| **Entity Framework Core** | Apache 2.0 | ✅ |
| **CsvHelper** | MS-PL | ✅ |
| **iTextSharp.LGPLv2.Core** | LGPL v2.1 | ✅ (LGPL 조건 준수 필요) |
| **Microsoft.Extensions.*** | MIT | ✅ |
| **Serilog** | Apache 2.0 | ✅ |
| **PdfSharp-MigraDoc** | MIT | ✅ |
| **Microsoft.VisualBasic** | MIT | ✅ |
| **gRPC** | Apache 2.0 | ✅ |

#### 제거 완료

| 라이브러리 | 라이선스 | 상태 |
|-----------|---------|------|
| **Xceed.Wpf.Toolkit** | 상용 라이선스 | ✅ **제거 완료** (사용하지 않음) |

**처리 완료:**

- ✅ Xceed.Wpf.Toolkit 사용 여부 확인 완료
- ✅ 실제 사용하지 않음을 확인
- ✅ 프로젝트에서 패키지 참조 제거 완료
- ✅ 모든 라이브러리가 오픈소스로 확인됨

---

### 3. 독립 실행 가능 여부 (다른 프로그램 설치 없이)

**✅ 가능합니다.** 다음 조건을 충족하면 됩니다:

#### 필수 요구사항

1. **.NET 8.0 런타임 포함**
   - **방법 1**: Self-contained 배포 (권장)
     - .NET 런타임을 포함한 독립 실행 파일 생성
     - 파일 크기 증가 (약 100-150MB)
     - .NET 설치 불필요
   
   - **방법 2**: Framework-dependent 배포
     - .NET 8.0 Runtime 설치 필요
     - 파일 크기 작음 (약 10-20MB)
     - 사용자 PC에 .NET 설치 필요

2. **GDAL Native DLL 포함**
   - 현재 프로젝트에서 자동 복사 설정됨
   - `gdal.dll`, `gdal_wrap.dll` 등 네이티브 DLL 포함 필요

3. **의존 DLL 포함**
   - 모든 NuGet 패키지 DLL 자동 포함됨
   - `PublishSingleFile` 옵션 사용 시 단일 파일로 패키징 가능

#### Self-contained 배포 설정

**프로젝트 파일 수정** (`SpatialCheckProMax.GUI.csproj`):

```xml
<PropertyGroup>
  <PublishSingleFile>true</PublishSingleFile>
  <SelfContained>true</SelfContained>
  <RuntimeIdentifier>win-x64</RuntimeIdentifier>
  <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
</PropertyGroup>
```

**배포 명령어:**

```bash
dotnet publish SpatialCheckProMax.GUI/SpatialCheckProMax.GUI.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -p:IncludeNativeLibrariesForSelfExtract=true
```

#### 배포 디렉토리 구조

```
SpatialCheckProMax/
├── SpatialCheckProMax.GUI.exe          # 단일 실행 파일 (Self-contained)
├── Config/                           # 설정 파일 디렉토리
│   ├── 1_table_check.csv
│   ├── 2_schema_check.csv
│   ├── 3_geometry_check.csv
│   ├── 4_attribute_check.csv
│   ├── 5_relation_check.csv
│   ├── geometry_criteria.csv
│   └── codelist.csv
└── (필요시) GDAL Native DLL들
```

---

## 🚀 배포 단계별 가이드

### Step 1: Self-contained 배포 준비

1. **프로젝트 파일 확인**
   - `SpatialCheckProMax.GUI.csproj`에 Self-contained 설정 추가

2. **빌드 및 배포**
   ```bash
   dotnet publish SpatialCheckProMax.GUI/SpatialCheckProMax.GUI.csproj `
     -c Release `
     -r win-x64 `
     --self-contained true `
     -p:PublishSingleFile=true `
     -p:IncludeNativeLibrariesForSelfExtract=true `
     -p:PublishTrimmed=false `
     -o ./publish
   ```

3. **출력 확인**
   - `publish/` 디렉토리에 단일 실행 파일 생성 확인
   - Config 디렉토리 포함 확인

### Step 2: 설치 프로그램 제작 (Inno Setup 예시)

**Inno Setup 스크립트** (`setup.iss`):

```inno
[Setup]
AppName=SpatialCheckProMax
AppVersion=1.0.0
DefaultDirName={pf}\SpatialCheckProMax
DefaultGroupName=SpatialCheckProMax
OutputDir=installer
OutputBaseFilename=SpatialCheckProMax_Setup_v1.0.0
Compression=lzma2
SolidCompression=yes
ArchitecturesAllowed=x64
ArchitecturesInstallIn64BitMode=x64

[Files]
Source: "publish\SpatialCheckProMax.GUI.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "publish\Config\*"; DestDir: "{app}\Config"; Flags: ignoreversion recursesubdirs

[Icons]
Name: "{group}\SpatialCheckProMax"; Filename: "{app}\SpatialCheckProMax.GUI.exe"
Name: "{commondesktop}\SpatialCheckProMax"; Filename: "{app}\SpatialCheckProMax.GUI.exe"

[Run]
Filename: "{app}\SpatialCheckProMax.GUI.exe"; Description: "SpatialCheckProMax 실행"; Flags: nowait postinstall skipifsilent
```

### Step 3: 테스트

1. **깨끗한 Windows PC에서 테스트**
   - .NET 미설치 상태에서 실행 확인
   - 모든 기능 정상 동작 확인

2. **의존성 확인**
   - Visual C++ Redistributable 필요 여부 확인
   - 기타 시스템 DLL 필요 여부 확인

---

## ⚠️ 주의사항

### 1. GDAL Native DLL

- GDAL Native DLL은 플랫폼별로 다릅니다 (x64, x86)
- 현재 프로젝트는 x64만 지원하도록 설정됨
- x86 지원이 필요하면 별도 빌드 필요

### 2. 라이선스 고지

배포 시 다음 라이선스 고지 필요:

- **LGPL 라이선스** (iTextSharp.LGPLv2.Core)
  - 소스 코드 제공 또는 링크된 라이브러리 정보 제공 필요
  - 사용자에게 라이선스 정보 제공

- **기타 오픈소스 라이선스**
  - 각 라이브러리의 라이선스 파일 포함 권장
  - `LICENSES.txt` 파일 생성

### 3. 파일 크기

- **Self-contained**: 약 100-150MB
- **Framework-dependent**: 약 10-20MB + .NET 8.0 Runtime (약 50-70MB)

### 4. 성능

- Self-contained 배포는 첫 실행 시 압축 해제 시간 소요
- 이후 실행은 정상 속도

---

## 📋 체크리스트

### 배포 전 확인사항

- [ ] Xceed.Wpf.Toolkit 라이선스 확인 또는 대안으로 교체
- [ ] Self-contained 배포 설정 완료
- [ ] Config 디렉토리 포함 확인
- [ ] GDAL Native DLL 포함 확인
- [ ] 깨끗한 PC에서 테스트 완료
- [ ] 라이선스 고지 파일 포함
- [ ] 설치 프로그램 제작 완료
- [ ] 사용자 매뉴얼 포함 (선택)

### 배포 후 확인사항

- [ ] 설치 프로그램 정상 동작
- [ ] .NET 미설치 PC에서 실행 확인
- [ ] 모든 검수 기능 정상 동작
- [ ] 설정 파일 읽기/쓰기 정상
- [ ] 로그 파일 생성 정상

---

## 🔧 추가 최적화 옵션

### 1. 파일 크기 최적화

```xml
<PropertyGroup>
  <PublishTrimmed>true</PublishTrimmed>
  <TrimMode>link</TrimMode>
</PropertyGroup>
```

**주의**: Trimmed 빌드는 일부 리플렉션 기반 코드에서 문제 발생 가능

### 2. ReadyToRun 컴파일

```xml
<PropertyGroup>
  <PublishReadyToRun>true</PublishReadyToRun>
</PropertyGroup>
```

- 시작 시간 단축
- 파일 크기 약간 증가

### 3. 코드 서명

- Authenticode 서명 추가 권장
- Windows Defender 경고 방지

---

## 📞 지원

배포 관련 문제 발생 시:

1. 로그 파일 확인 (`application_*.log`)
2. 의존성 확인 (Dependency Walker 등)
3. 이벤트 뷰어 확인 (Windows 로그)


