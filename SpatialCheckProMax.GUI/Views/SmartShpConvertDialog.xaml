<Window x:Class="SpatialCheckProMax.GUI.Views.SmartShpConvertDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="스마트 SHP 변환" 
        Height="700" Width="1100"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#F8FAFC">

    <Window.Resources>
        <!-- 버튼 스타일 -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1D4ED8"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#94A3B8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#E2E8F0"/>
            <Setter Property="Foreground" Value="#475569"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#CBD5E1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="BrowseButton" TargetType="Button">
            <Setter Property="Background" Value="#64748B"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#475569"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid 스타일 -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#F1F5F9"/>
            <Setter Property="Foreground" Value="#334155"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 타이틀 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="스마트 SHP 변환(대용량 자동 분할)" 
                       FontSize="20" 
                       FontWeight="Bold" 
                       Foreground="#0F172A"/>
            <TextBlock Text="대용량 레이어를 자동으로 분할하고 공간 정렬하여 Shapefile로 변환합니다. (2GB 제한 자동 처리)" 
                       FontSize="12" 
                       Foreground="#64748B" 
                       Margin="0,4,0,0"
                       TextWrapping="Wrap"/>
        </StackPanel>

        <!-- 경로 선택 영역 -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 소스 FileGDB -->
            <StackPanel Grid.Column="0">
                <TextBlock Text="소스 FileGDB" 
                           FontSize="12" 
                           FontWeight="SemiBold" 
                           Foreground="#334155" 
                           Margin="0,0,0,6"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="SourcePathTextBox" 
                             Height="34" 
                             Padding="10,7" 
                             FontSize="12"
                             BorderBrush="#CBD5E1"
                             BorderThickness="1"
                             IsReadOnly="True"
                             Background="White"
                             VerticalContentAlignment="Center"/>
                    <Button Grid.Column="1" 
                            Content="찾아보기" 
                            Style="{StaticResource BrowseButton}" 
                            Margin="6,0,0,0"
                            Click="BrowseSource_Click"/>
                </Grid>
            </StackPanel>

            <!-- 출력 폴더 -->
            <StackPanel Grid.Column="2">
                <TextBlock Text="출력 폴더" 
                           FontSize="12" 
                           FontWeight="SemiBold" 
                           Foreground="#334155" 
                           Margin="0,0,0,6"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="OutputPathTextBox" 
                             Height="34" 
                             Padding="10,7" 
                             FontSize="12"
                             BorderBrush="#CBD5E1"
                             BorderThickness="1"
                             IsReadOnly="True"
                             Background="White"
                             VerticalContentAlignment="Center"/>
                    <Button Grid.Column="1" 
                            Content="찾아보기" 
                            Style="{StaticResource BrowseButton}" 
                            Margin="6,0,0,0"
                            Click="BrowseOutput_Click"/>
                </Grid>
            </StackPanel>
        </Grid>

        <!-- 옵션 영역 -->
        <Border Grid.Row="2" Background="#F1F5F9" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <CheckBox x:Name="UseGridStreamingCheckBox" 
                          Grid.Column="0"
                          Content="⚡ 고성능 모드 (그리드 스트리밍)" 
                          IsChecked="True"
                          FontSize="12"
                          Foreground="#334155"
                          VerticalContentAlignment="Center"
                          ToolTip="한 번의 스캔으로 빠르게 변환합니다. 대용량 데이터에 권장."/>

                <CheckBox x:Name="GenerateIndexCheckBox" 
                          Grid.Column="2"
                          Content="인덱스 파일 생성" 
                          IsChecked="True"
                          FontSize="12"
                          Foreground="#334155"
                          VerticalContentAlignment="Center"/>

                <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="목표 파일 크기:" 
                               FontSize="12" 
                               Foreground="#334155"
                               VerticalAlignment="Center"
                               Margin="0,0,6,0"/>
                    <ComboBox x:Name="TargetSizeComboBox" 
                              Width="100" 
                              Height="28"
                              FontSize="12"
                              SelectedIndex="1">
                        <ComboBoxItem Content="1.2 GB"/>
                        <ComboBoxItem Content="1.4 GB"/>
                        <ComboBoxItem Content="1.6 GB"/>
                    </ComboBox>
                </StackPanel>

                <Button x:Name="AnalyzeButton"
                        Grid.Column="6"
                        Content="레이어 분석"
                        Style="{StaticResource SecondaryButton}"
                        Padding="14,8"
                        Click="Analyze_Click"
                        IsEnabled="False"/>
            </Grid>
        </Border>

        <!-- 레이어 목록 (DataGrid) -->
        <Border Grid.Row="3" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="6" Margin="0,0,0,12">
            <DataGrid x:Name="LayerDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#E2E8F0"
                      Background="White"
                      RowHeight="32"
                      FontSize="12"
                      SelectionMode="Extended">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="선택" 
                                            Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="50"/>
                    <DataGridTextColumn Header="레이어명" 
                                        Binding="{Binding Name}" 
                                        Width="*"
                                        IsReadOnly="True"/>
                    <DataGridTextColumn Header="지오메트리" 
                                        Binding="{Binding GeometryType}" 
                                        Width="100"
                                        IsReadOnly="True"/>
                    <DataGridTextColumn Header="피처 수" 
                                        Binding="{Binding FeatureCountFormatted}" 
                                        SortMemberPath="FeatureCount"
                                        Width="100"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Margin" Value="0,0,8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="예상 용량" 
                                        Binding="{Binding EstimatedSizeFormatted}" 
                                        SortMemberPath="EstimatedTotalBytes"
                                        Width="90"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Margin" Value="0,0,8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="분할 수" 
                                        Binding="{Binding SplitCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                        Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.EditingElementStyle>
                            <Style TargetType="TextBox">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.EditingElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="상태" 
                                        Binding="{Binding Status}" 
                                        Width="100"
                                        IsReadOnly="True"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- 요약 정보 -->
        <Border Grid.Row="4" Background="#EFF6FF" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="선택 레이어" FontSize="11" Foreground="#64748B" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="SelectedLayerCountText" Text="0개" FontSize="16" FontWeight="Bold" Foreground="#1E40AF" HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="총 피처 수" FontSize="11" Foreground="#64748B" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="TotalFeatureCountText" Text="0" FontSize="16" FontWeight="Bold" Foreground="#1E40AF" HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="예상 총 용량" FontSize="11" Foreground="#64748B" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="TotalEstimatedSizeText" Text="0 GB" FontSize="16" FontWeight="Bold" Foreground="#1E40AF" HorizontalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="생성 파일 수" FontSize="11" Foreground="#64748B" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="TotalFileCountText" Text="0개" FontSize="16" FontWeight="Bold" Foreground="#1E40AF" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 진행률 -->
        <Grid Grid.Row="5" Margin="0,0,0,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="진행 상태: " 
                           FontSize="12" 
                           FontWeight="SemiBold" 
                           Foreground="#334155"/>
                <TextBlock x:Name="StatusText" 
                           Text="소스 FileGDB를 선택하세요" 
                           FontSize="12" 
                           Foreground="#64748B"/>
            </StackPanel>
            <ProgressBar x:Name="ConvertProgressBar" 
                         Grid.Row="1" 
                         Height="8" 
                         Minimum="0" 
                         Maximum="100" 
                         Value="0"
                         Foreground="#2563EB"
                         Background="#E2E8F0"/>
        </Grid>

        <!-- 버튼 -->
        <StackPanel Grid.Row="6" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="전체 선택" 
                    Style="{StaticResource SecondaryButton}" 
                    Padding="12,8"
                    Click="SelectAll_Click"/>
            <Button Content="선택 해제" 
                    Style="{StaticResource SecondaryButton}" 
                    Padding="12,8"
                    Margin="8,0,0,0"
                    Click="DeselectAll_Click"/>
            <Button x:Name="ConvertButton" 
                    Content="변환 시작" 
                    Style="{StaticResource PrimaryButton}" 
                    Width="120"
                    Margin="20,0,0,0"
                    IsEnabled="False"
                    Click="Convert_Click"/>
            <Button Content="닫기" 
                    Style="{StaticResource SecondaryButton}" 
                    Width="80"
                    Margin="8,0,0,0"
                    Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>


