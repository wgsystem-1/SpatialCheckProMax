<UserControl x:Class="SpatialCheckProMax.GUI.Views.ValidationResultView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- 배치 통계 대시보드 (배치 검수 시에만 표시) - 탭 위 전용 행으로 분리하여 겹침 방지 -->
        <Border x:Name="BatchStatisticsCard" 
                Grid.Row="1" 
                Style="{StaticResource ModernCard}" 
                Margin="0,0,0,24"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 카드 헤더 -->
                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                    <TextBlock Text="전체 검수 통계" Style="{StaticResource HeadingMedium}"/>
                    <TextBlock Text="배치 검수 전체 결과 요약" Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- 통계 그리드 -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 총 파일 수 -->
                    <Border Grid.Column="0" Style="{StaticResource ModernCard}" Background="#F8FAFC" Padding="20" Margin="0,0,8,0">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="검수 파일" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            <TextBlock x:Name="TotalFilesValueText" 
                                      Text="0개" 
                                      FontSize="32" 
                                      FontWeight="Bold" 
                                      Foreground="{StaticResource PrimaryColor}"
                                      HorizontalAlignment="Center"
                                      Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- 성공 -->
                    <Border Grid.Column="1" Style="{StaticResource ModernCard}" Background="#ECFDF5" Padding="20" Margin="0,0,8,0">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="성공" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            <TextBlock x:Name="SuccessCountValueText" 
                                      Text="0개" 
                                      FontSize="32" 
                                      FontWeight="Bold" 
                                      Foreground="#10B981"
                                      HorizontalAlignment="Center"
                                      Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- 실패 -->
                    <Border Grid.Column="2" Style="{StaticResource ModernCard}" Background="#FEF2F2" Padding="20" Margin="0,0,8,0">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="실패" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            <TextBlock x:Name="FailureCountValueText" 
                                      Text="0개" 
                                      FontSize="32" 
                                      FontWeight="Bold" 
                                      Foreground="#EF4444"
                                      HorizontalAlignment="Center"
                                      Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- 총 오류 -->
                    <Border Grid.Column="3" Style="{StaticResource ModernCard}" Background="#FFF7ED" Padding="20" Margin="0,0,8,0">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="총 오류" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            <TextBlock x:Name="TotalErrorsValueText" 
                                      Text="0개" 
                                      FontSize="32" 
                                      FontWeight="Bold" 
                                      Foreground="#F97316"
                                      HorizontalAlignment="Center"
                                      Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- 전체 소요 시간 -->
                    <Border Grid.Column="4" Style="{StaticResource ModernCard}" Background="#F0F9FF" Padding="20">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="소요 시간" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                            <TextBlock x:Name="TotalDurationText" 
                                      Text="00:00 분:초" 
                                      FontSize="28" 
                                      FontWeight="Bold" 
                                      Foreground="#0EA5E9"
                                      HorizontalAlignment="Center"
                                      Margin="0,8,0,4"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>
        <!-- 헤더 -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="검수 결과 대시보드" Style="{StaticResource HeadingLarge}"/>
                <TextBlock x:Name="BatchSummaryText" 
                          Text="" 
                          Style="{StaticResource CaptionText}" 
                          Margin="0,4,0,0"
                          Visibility="Collapsed"/>
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <Border x:Name="CurrentResultBadge"
                            Background="#DBEAFE"
                            CornerRadius="6"
                            Padding="8,2"
                            Margin="0,0,8,0"
                            Visibility="Collapsed">
                        <TextBlock x:Name="CurrentResultBadgeText"
                                   Foreground="#1D4ED8"
                                   FontWeight="SemiBold"/>
                    </Border>
                    <TextBlock x:Name="CurrentResultFileNameText"
                              Text=""
                              Style="{StaticResource CaptionText}"
                              FontWeight="SemiBold"
                              Foreground="#1F2937"
                              Visibility="Collapsed"/>
                </StackPanel>
                <TextBlock x:Name="CurrentResultFilePathText"
                          Text=""
                          Style="{StaticResource CaptionText}"
                          Foreground="#6B7280"
                          Margin="0,2,0,0"
                          Visibility="Collapsed"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <!-- 배치 파일 선택 콤보박스 -->
                <ComboBox x:Name="BatchResultSelector" Width="360" Margin="0,0,8,0"
                          Visibility="Collapsed"
                          SelectionChanged="BatchResultSelector_SelectionChanged"/>
                <!-- 검수 진행 버튼 -->
                <Button x:Name="StartValidationButton" Style="{StaticResource PrimaryButton}" Click="StartValidationButton_Click" Padding="20,12" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource PlayIcon}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="검수 진행" Foreground="White"/>
                    </StackPanel>
                </Button>
                <!-- 판정설명 버튼 -->
                <Button x:Name="ExplainButton" Style="{StaticResource SecondaryButton}" Click="ExplainButton_Click" Padding="20,12" Margin="12,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource InfoIcon}" Fill="{StaticResource PrimaryColor}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="판정설명"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>



        <!-- 탭 컨트롤 (대시보드/단계별/전체 결과) -->
        <TabControl Grid.Row="2" x:Name="ResultTabControl"
                   Background="Transparent" 
                   BorderThickness="0">
            <TabControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"/>
                </ItemsPanelTemplate>
            </TabControl.ItemsPanel>
            <TabControl.Resources>
                <!-- 탭 배경/테두리 색상 (모던 톤) -->
                <SolidColorBrush x:Key="TabNormalBg" Color="#F1F5F9"/>
                <SolidColorBrush x:Key="TabHoverBg" Color="#E2E8F0"/>
                <SolidColorBrush x:Key="TabSelectedBg" Color="#DBEAFE"/>
                <SolidColorBrush x:Key="TabSelectedBorder" Color="#3B82F6"/>
                <SolidColorBrush x:Key="TabTextNormal" Color="#334155"/>
                <SolidColorBrush x:Key="TabTextSelected" Color="#2563EB"/>

                <!-- 탭 아이템 스타일: 라운드 칩 형태 -->
                <Style TargetType="TabItem">
                    <Setter Property="Background" Value="{StaticResource TabNormalBg}"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Foreground" Value="{StaticResource TabTextNormal}"/>
                    <Setter Property="Padding" Value="14,8"/>
                    <Setter Property="Margin" Value="8,0,0,0"/>
                    <Setter Property="MinWidth" Value="140"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Bd"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="10"
                                        Padding="{TemplateBinding Padding}"
                                        SnapsToDevicePixels="True">
                                    <ContentPresenter x:Name="ContentSite"
                                                      ContentSource="Header"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      RecognizesAccessKey="True"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <!-- 선택 상태 -->
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="{StaticResource TabSelectedBg}"/>
                                        <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource TabSelectedBorder}"/>
                                        <Setter Property="Foreground" Value="{StaticResource TabTextSelected}"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="Panel.ZIndex" Value="1"/>
                                    </Trigger>
                                    <!-- 호버 상태 -->
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="{StaticResource TabHoverBg}"/>
                                    </Trigger>
                                    <!-- 비활성화 -->
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#9CA3AF"/>
                                        <Setter TargetName="Bd" Property="Opacity" Value="0.8"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <!-- 대시보드 탭 -->
            <TabItem Header="대시보드" x:Name="DashboardTab">
                <!-- 와이드 대시보드 -->
                <ContentControl x:Name="WideDashboardContainer"/>
            </TabItem>



            <!-- 1단계 테이블 검수 탭 -->
            <TabItem Header="1단계: 테이블 검수" x:Name="Stage1Tab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                                    <TextBlock Text="1단계: 테이블 검수 결과" Style="{StaticResource HeadingMedium}"/>
                                    <TextBlock Text="테이블 구조 및 피처 타입 검증 결과" 
                                              Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <!-- 1단계 검수 요약 -->
                                <Grid Grid.Row="1" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 총 테이블 -->
                                    <Border Grid.Column="0" Style="{StaticResource KpiCard}" 
                                           Background="#F0F9FF" BorderBrush="#2563EB" Margin="0,0,8,0" Height="75" VerticalAlignment="Center">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="총 테이블" Style="{StaticResource CaptionText}" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage1TotalTablesText" Text="0" 
                                                      Style="{StaticResource HeadingMedium}" 
                                                      Foreground="#2563EB"
                                                      HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 정의된 테이블 없음 수 -->
                                    <Border Grid.Column="1" Style="{StaticResource KpiCard}" 
                                           Background="#FEF2F2" BorderBrush="#DC2626" Margin="8,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="테이블 누락 수" Style="{StaticResource CaptionText}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage1MissingDefinedTablesText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 미정의된 테이블 수 -->
                                    <Border Grid.Column="2" Style="{StaticResource KpiCard}" 
                                           Background="#FEF2F2" BorderBrush="#DC2626" Margin="8,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="미정의 테이블 수" Style="{StaticResource CaptionText}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage1UndefinedTablesText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 객체 미존재 테이블 수 -->
                                    <Border Grid.Column="3" Style="{StaticResource KpiCard}" 
                                           Background="#FFFBEB" BorderBrush="#D97706" Margin="8,0,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="빈 테이블 수" Style="{StaticResource CaptionText}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage1ZeroFeatureTablesText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#D97706" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <DataGrid Grid.Row="2" x:Name="TableResultsGrid" 
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="300"
                                         MaxHeight="400"
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True"
                                         ColumnWidth="*">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Table Id" Binding="{Binding TableId}" Width="*"/>
                                        <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="*"/>
                                        <DataGridTextColumn Header="Feature Count" Binding="{Binding FeatureCount, TargetNullValue='N/A'}" Width="*"/>
                                        <DataGridTextColumn Header="Feature Type" Binding="{Binding FeatureType}" Width="*"/>
                                        <DataGridTextColumn Header="Feature Type Check" Binding="{Binding FeatureTypeCheck}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 2단계 스키마 검수 탭 -->
            <TabItem Header="2단계: 스키마 검수" x:Name="Stage2Tab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                                    <TextBlock Text="2단계: 스키마 검수 결과" Style="{StaticResource HeadingMedium}"/>
                                    <TextBlock Text="컬럼 구조, 데이터 타입, 제약조건 검증 결과" 
                                              Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <!-- 2단계 검수 요약 -->
                                <Grid Grid.Row="1" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 총 컬럼 검사 -->
                                    <Border Grid.Column="0" Style="{StaticResource KpiCard}" 
                                           Background="#F0F9FF" BorderBrush="Transparent" BorderThickness="0" Margin="0,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="총 컬럼 검사" Style="{StaticResource CaptionText}" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage2TotalColumnsText" Text="0" 
                                                      Style="{StaticResource HeadingMedium}" 
                                                      Foreground="#2563EB"
                                                      HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 오류 수 -->
                                    <Border Grid.Column="1" Style="{StaticResource KpiCard}" 
                                           Background="#FEF2F2" BorderBrush="Transparent" BorderThickness="0" Margin="8,0,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="오류" Style="{StaticResource CaptionText}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage2ErrorCountText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <DataGrid Grid.Row="2" x:Name="SchemaResultsGrid" 
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="300"
                                         MaxHeight="400"
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True"
                                         ColumnWidth="*">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="TableId" Binding="{Binding TableId}" Width="*"/>
                                        <DataGridTextColumn Header="TableName" Binding="{Binding TableName}" Width="*"/>
                                        <DataGridTextColumn Header="FieldName" Binding="{Binding ColumnName}" Width="*"/>
                                        <DataGridTextColumn Header="FieldAlias" Binding="{Binding ColumnKoreanName}" Width="*"/>
                                        <DataGridTextColumn Header="Expected DataType" Binding="{Binding ExpectedDataType}" Width="*"/>
                                        <DataGridTextColumn Header="Actual DataType" Binding="{Binding ActualDataType}" Width="*"/>
                                        <DataGridTextColumn Header="Length Match" Binding="{Binding LengthMatches}" Width="*"/>
                                        <DataGridTextColumn Header="NN Match" Binding="{Binding NotNullMatches}" Width="*"/>
                                        <DataGridTextColumn Header="Validation Result" Binding="{Binding IsValid}" Width="*"/>
                                        <DataGridTextColumn Header="Error Content" Binding="{Binding ErrorContent}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 3단계 지오메트리 검수 탭 -->
            <TabItem Header="3단계: 지오메트리 검수" x:Name="Stage3Tab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0,0,0,20">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="3단계: 지오메트리 검수 결과" Style="{StaticResource HeadingMedium}"/>
                                        <TextBlock Text="중복, 겹침, 꼬임, 슬리버 폴리곤 검사 결과"
                                                  Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                    </StackPanel>
                                    <!-- AI 자동 수정 버튼 -->
                                    <Button x:Name="AiAutoFixButton"
                                            Grid.Column="1"
                                            Style="{StaticResource PrimaryButton}"
                                            Click="AiAutoFixButton_Click"
                                            Padding="16,10"
                                            VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17V16H9V14H13V13H10A1,1 0 0,1 9,12V9A1,1 0 0,1 10,8H11V7H13V8H15V10H11V11H14A1,1 0 0,1 15,12V15A1,1 0 0,1 14,16H13V17H11Z"
                                                  Fill="White" Width="18" Height="18" Stretch="Uniform" Margin="0,0,8,0"/>
                                            <TextBlock Text="AI 자동 수정" Foreground="White" FontWeight="SemiBold"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>

                                <!-- 3단계 검수 요약 -->
                                <Grid Grid.Row="1" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 검사 테이블 수 -->
                                    <Border Grid.Column="0" Style="{StaticResource KpiCard}" 
                                           Background="#F0F9FF" BorderBrush="#2563EB" Margin="0,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="검사 테이블" Style="{StaticResource CaptionText}" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage3TableCountText" Text="0" 
                                                      Style="{StaticResource HeadingMedium}" 
                                                      Foreground="#2563EB"
                                                      HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 오류 합계 -->
                                    <Border Grid.Column="1" Style="{StaticResource KpiCard}"
                                           Background="#FEF2F2" BorderBrush="#DC2626" Margin="8,0,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="오류 합계" Style="{StaticResource CaptionText}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock x:Name="Stage3ErrorSumText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <DataGrid Grid.Row="2" x:Name="GeometryResultsGrid"
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="300"
                                         MaxHeight="400"
                                         CanUserSortColumns="True"
                                         
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Table Id" Binding="{Binding TableId}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="TableId"/>
                                        <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="TableName"/>
                                        <DataGridTemplateColumn Header="Error Types Summary" Width="*" 
                                                               CanUserSort="True" SortMemberPath="ErrorTypesSummary">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ErrorTypesSummary}" 
                                                              ToolTip="{Binding PrimaryErrorType}"
                                                              TextWrapping="Wrap">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="False">
                                                                        <Setter Property="Foreground" Value="#10B981"/>
                                                                        <Setter Property="FontWeight" Value="Medium"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                        <Setter Property="Foreground" Value="#EF4444"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Count" Width="*" 
                                                               CanUserSort="True" SortMemberPath="ErrorCount">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ErrorCount}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ErrorCount}" Value="0">
                                                                        <Setter Property="Foreground" Value="#10B981"/>
                                                                        <Setter Property="FontWeight" Value="Medium"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                        <Setter Property="Foreground" Value="#EF4444"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                        <Setter Property="Cursor" Value="Hand"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Status" Width="*" 
                                                               CanUserSort="True" SortMemberPath="Status">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Status}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Status}" Value="통과">
                                                                        <Setter Property="Foreground" Value="#10B981"/>
                                                                        <Setter Property="FontWeight" Value="Medium"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Status}" Value="실패">
                                                                        <Setter Property="Foreground" Value="#EF4444"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Status}" Value="">
                                                                        <Setter Property="Foreground" Value="#F59E0B"/>
                                                                        <Setter Property="FontWeight" Value="Medium"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 4단계 속성 검수 탭 -->
            <TabItem Header="4단계: 속성 관계 검수" x:Name="Stage4Tab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">

                        <!-- 속성 검수 요약 카드 -->
                        <Border Style="{StaticResource ModernCard}" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                                    <TextBlock Text="4단계:속성 관계 검수" Style="{StaticResource HeadingMedium}"/>
                                    <TextBlock Text="속성 값 기반 규칙 검수 결과" Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1*"/>
                                        <ColumnDefinition Width="1*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 검사된 규칙(속성): 첫 번째 -->
                                    <Border Grid.Column="0" Style="{StaticResource KpiCard}" Background="#F0F9FF" BorderBrush="#2563EB" Margin="0,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="검사된 규칙" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="Stage5RuleCountText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#2563EB" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 속성 관계 오류: 두 번째 -->
                                    <Border Grid.Column="1" Style="{StaticResource KpiCard}" Background="#FEF2F2" BorderBrush="#DC2626" Margin="8,0,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="속성 관계 오류" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="AttributeErrorCountText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- 속성 관계 오류/경고 목록 -->
                        <Border Style="{StaticResource ModernCard}" Margin="0,0,0,16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,16"/>

                                <DataGrid Grid.Row="1" x:Name="AttributeRelationErrorsGrid" 
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="200"
                                         MaxHeight="300"
                                         CanUserSortColumns="True"
                                         
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Table Id" Binding="{Binding TableId}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="TableId"/>
                                        <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="TableName"/>
                                        <DataGridTextColumn Header="Field Name" Binding="{Binding FieldName}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="FieldName"/>
                                        <DataGridTextColumn Header="Rule Name" Binding="{Binding RuleName}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="RuleName"/>
                                        <DataGridTextColumn Header="Object Id" Binding="{Binding ObjectId}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="ObjectId"/>
                                        <DataGridTextColumn Header="Expected Value" Binding="{Binding ExpectedValue}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="ExpectedValue"/>
                                        <DataGridTextColumn Header="Actual Value" Binding="{Binding ActualValue}" Width="*" 
                                                           CanUserSort="True" SortMemberPath="ActualValue"/>
                                        <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*"/>

                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>


                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 5단계 공간 관계 검수 탭 -->
            <TabItem Header="5단계: 공간 관계 검수" x:Name="Stage5Tab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">

                        <!-- 공간 관계 요약 카드 -->
                        <Border Style="{StaticResource ModernCard}" Margin="0,0,0,16" Height="177.12">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                                    <TextBlock Text="공간 관계 검수 요약" Style="{StaticResource HeadingMedium}"/>
                                    <TextBlock Text="점-폴리곤, 선-폴리곤, 폴리곤-폴리곤 관계 검수 결과 요약" Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 검사된 규칙(공간): 첫 번째 -->
                                    <Border Grid.Column="0" Style="{StaticResource KpiCard}" Background="#F0F9FF" BorderBrush="#2563EB" Margin="0,0,8,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="검사된 규칙" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="TotalRulesText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#2563EB" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- 공간 관계 오류: 붉은 계열 -->
                                    <Border Grid.Column="1" Style="{StaticResource KpiCard}" Background="#FEF2F2" BorderBrush="#DC2626" Margin="8,0,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="공간 관계 오류" Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                                            <TextBlock x:Name="SpatialErrorCountText" Text="0" Style="{StaticResource HeadingMedium}" Foreground="#DC2626" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- 공간 관계 오류 목록 -->
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,16"/>

                                <DataGrid Grid.Row="1" x:Name="SpatialRelationErrorsGrid" 
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="200"
                                         MaxHeight="400"
                                         CanUserSortColumns="True"
                                         
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Table Id" Binding="{Binding TableId}" Width="*" CanUserSort="True" SortMemberPath="TableId"/>
                                        <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="*" CanUserSort="True" SortMemberPath="TableName"/>
                                        <DataGridTextColumn Header="Relation Type" Binding="{Binding RelationType}" Width="*" CanUserSort="True" SortMemberPath="RelationType"/>
                                        <DataGridTextColumn Header="Error Type" Binding="{Binding ErrorType}" Width="*" CanUserSort="True" SortMemberPath="ErrorType"/>
                                        <DataGridTextColumn Header="Source Object Id" Binding="{Binding SourceObjectId}" Width="*" CanUserSort="True" SortMemberPath="SourceObjectId"/>
                                        <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 전체 결과 탭 -->
            <TabItem Header="전체 결과" x:Name="AllResultsTab">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Margin="0,0,0,20">
                                    <TextBlock Text="전체 검수 결과" Style="{StaticResource HeadingMedium}"/>
                                    <TextBlock Text="모든 단계의 결과 통합 목록" 
                                              Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>

                                <!-- 고급 필터: 가독성 향상을 위한 2행 그리드 레이아웃 -->
                                <Grid Grid.Row="1" Margin="0,0,0,16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 1행: 포함/제외 키워드 + 테이블 필터 + 초기화 -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                                        <StackPanel Width="260" Margin="0,0,12,0">
                                            <TextBlock Text="Include Keywords" Style="{StaticResource CaptionText}"/>
                                            <TextBox x:Name="IncludeTextBox" Style="{StaticResource ModernTextBox}"/>
                                        </StackPanel>
                                        <StackPanel Width="260" Margin="0,0,12,0">
                                            <TextBlock Text="Exclude Keywords" Style="{StaticResource CaptionText}"/>
                                            <TextBox x:Name="ExcludeTextBox" Style="{StaticResource ModernTextBox}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- 1행: 테이블 필터 검색 -->
                                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Vertical" Margin="0,0,0,0">
                                        <TextBlock Text="Table Filter" Style="{StaticResource CaptionText}"/>
                                        <TextBox x:Name="TableFilterSearchBox" Style="{StaticResource ModernTextBox}" MinWidth="260"/>
                                    </StackPanel>

                                    <Button Grid.Row="0" Grid.Column="2" x:Name="ClearFiltersButton" Content="Clear All" Style="{StaticResource SecondaryButton}" VerticalAlignment="Top"/>

                                    <!-- 2행: 단계/심각도/테이블 -->
                                    <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,8,0,0">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                            <TextBlock Text="Stage" Style="{StaticResource CaptionText}" Margin="0,0,8,0"/>
                                            <UniformGrid Rows="1" Columns="5" Width="180">
                                                <CheckBox x:Name="Stage1Check" Content="1"/>
                                                <CheckBox x:Name="Stage2Check" Content="2"/>
                                                <CheckBox x:Name="Stage3Check" Content="3"/>
                                                <CheckBox x:Name="Stage4Check" Content="4"/>
                                                <CheckBox x:Name="Stage5Check" Content="5"/>
                                            </UniformGrid>
                                        </StackPanel>
                                        <!-- 심각도 필터 제거 -->
                                    </StackPanel>

                                    <!-- 테이블 리스트 제거: 검색창만 사용 -->
                                </Grid>

                                <!-- 결과 데이터 그리드 -->
                                <DataGrid Grid.Row="2" x:Name="ResultsDataGrid" 
                                         AutoGenerateColumns="False" 
                                         IsReadOnly="True"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         AlternatingRowBackground="#F8FAFC"
                                         MinHeight="400"
                                         MaxHeight="500"
                                         ScrollViewer.CanContentScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         CanUserResizeColumns="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Stage" Binding="{Binding Stage}" Width="100" SortMemberPath="Stage"/>
                                        <DataGridTextColumn Header="Table Id" Binding="{Binding TableId}" Width="140" SortMemberPath="TableId"/>
                                        <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="160" SortMemberPath="TableName"/>
                                        <DataGridTextColumn Header="Error Type" Binding="{Binding ErrorType}" Width="160" SortMemberPath="ErrorType"/>
                                        <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*" SortMemberPath="Message"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</UserControl>
